# Алгоритм по шагам для функции создания маршрута (New Route)

## Шаг 1. Начало.

**Входные данные:**
- `TransportSystem& system` – ссылка на систему транспорта, в которую будет добавлен маршрут;
- Ввод от пользователя через консоль:
  - `int routeNumber` – номер маршрута;
  - `std::string transportType` – тип транспорта (Автобус/Трамвай/Троллейбус);
  - `std::vector<std::string> stops` – список остановок маршрута;

**Выходные данные:**
- Маршрут успешно добавлен в систему или выведено сообщение об ошибке;

## Шаг 2. Объявить переменные для ввода данных.

Объявить и инициализировать переменные:
- `int number` – для хранения номера маршрута;
- `std::string vehicleType` – для хранения типа транспорта;
- `std::vector<std::string> stops` – для хранения списка остановок;
- `std::string stop` – для временного хранения вводимой остановки;

## Шаг 3. Ввести номер маршрута.

Вывести приглашение: "Введите номер маршрута: ".

Выполнить ввод номера маршрута: `std::cin >> number`.

**Проверить корректность ввода:**
- Если условие `!(std::cin >> number)` истинно (ввод некорректен):
  - Очистить поток ввода: `std::cin.clear()`
  - Игнорировать оставшиеся символы: `std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n')`
  - Сгенерировать исключение `InputException` с сообщением "Неверный формат ввода для номера маршрута"
  - Перейти к обработке исключений (Шаг 12)
- Если условие ложно (ввод корректен):
  - Игнорировать символ новой строки: `std::cin.ignore()`
  - Перейти к Шагу 4

## Шаг 4. Ввести тип транспорта.

Вывести приглашение: "Введите тип транспорта (Автобус/Трамвай/Троллейбус): ".

Выполнить ввод типа транспорта: `std::getline(std::cin, vehicleType)`.

## Шаг 5. Ввести список остановок маршрута.

Вывести приглашение: "Введите остановки маршрута (введите 'конец' для завершения):".

**Начать цикл ввода остановок:**

**Шаг 5.1. Начало цикла ввода остановок.**

**Шаг 5.2. Вывести приглашение для остановки.**

Вывести: "Остановка: ".

**Шаг 5.3. Ввести название остановки.**

Выполнить ввод: `std::getline(std::cin, stop)`.

**Шаг 5.4. Проверить условие завершения ввода.**

Проверить условие: `stop == "конец"`.

- Если условие истинно (введено "конец"):
  - Прервать цикл ввода остановок
  - Перейти к Шагу 6
- Если условие ложно (введена остановка):
  - Добавить остановку в список: `stops.push_back(stop)`
  - Вернуться к Шагу 5.2 (продолжить цикл ввода)

**Шаг 5.5. Завершить цикл ввода остановок.**

## Шаг 6. Проверить наличие остановок в списке.

Проверить условие: `stops.empty()`.

- Если условие истинно (список остановок пуст):
  - В конструкторе `Route` будет сгенерировано исключение `ContainerException` с сообщением "Маршрут не может быть пустым"
  - Перейти к обработке исключений (Шаг 12)
- Если условие ложно (есть остановки):
  - Перейти к Шагу 7

## Шаг 7. Создать объект маршрута.

Вызвать конструктор `Route`: `auto route = std::make_shared<Route>(number, vehicleType, stops)`.

**В конструкторе Route выполняется:**

**Шаг 7.1. Инициализация полей маршрута.**

- Присвоить `number` = `num`
- Присвоить `vehicleType` = `vType`
- Присвоить `allStops` = `stops`

**Шаг 7.2. Проверить, что список остановок не пуст.**

Проверить условие: `stops.empty()`.

- Если условие истинно (список пуст):
  - Сгенерировать исключение `ContainerException` с сообщением "Маршрут не может быть пустым"
  - Перейти к обработке исключений (Шаг 12)
- Если условие ложно (есть остановки):
  - Продолжить выполнение

**Шаг 7.3. Установить начальную и конечную остановки.**

- Присвоить `startStop` = `stops.front()` (первая остановка в списке)
- Присвоить `endStop` = `stops.back()` (последняя остановка в списке)

**Примечание:** В текущей реализации проверка на совпадение начальной и конечной остановок выполняется неявно через проверку пустоты списка (если список содержит только одну остановку, то `front()` и `back()` будут одинаковыми, но это не обрабатывается явно).

## Шаг 8. Вызвать метод добавления маршрута в систему.

Вызвать метод: `system.addRoute(route)`.

**В методе `TransportSystem::addRoute()` выполняется:**

**Шаг 8.1. Проверить уникальность номера маршрута.**

**Начать цикл проверки существующих маршрутов:**

**Шаг 8.1.1. Начало цикла по существующим маршрутам.**

Для каждого маршрута `existingRoute` в списке `routes` выполнить Шаги 8.1.2-8.1.3.

**Шаг 8.1.2. Проверить совпадение номеров маршрутов.**

Проверить условие: `existingRoute->getNumber() == route->getNumber()`.

- Если условие истинно (номер уже существует):
  - Сгенерировать исключение `ContainerException` с сообщением "Маршрут с номером [номер] уже существует"
  - Перейти к обработке исключений (Шаг 12)
- Если условие ложно (номер уникален):
  - Продолжить проверку следующего маршрута

**Шаг 8.1.3. Завершить цикл проверки существующих маршрутов.**

**Шаг 8.2. Создать команду для добавления маршрута.**

Создать команду: `std::make_unique<AddRouteCommand>(this, route)` и сохранить в переменную `cmd`.

**Шаг 8.3. Выполнить команду через историю команд.**

Вызвать метод: `commandHistory.executeCommand(std::move(cmd))`.

**В методе `CommandHistory::executeCommand()` выполняется:**

**Шаг 8.3.1. Добавить команду в историю.**

- Добавить команду в стек истории команд
- Сохранить описание команды

**Шаг 8.3.2. Выполнить команду.**

Вызвать метод: `cmd->execute()`.

**В методе `AddRouteCommand::execute()` выполняется:**

**Шаг 8.3.2.1. Вызвать прямой метод добавления маршрута.**

Вызвать метод: `system->addRouteDirect(route)`.

**В методе `TransportSystem::addRouteDirect()` выполняется:**

**Шаг 8.3.2.1.1. Добавить маршрут в список.**

Выполнить: `routes.push_back(std::move(route))` – добавить маршрут в конец списка маршрутов системы.

## Шаг 9. Вывести сообщение об успешном создании.

Вывести сообщение: "Маршрут успешно добавлен!\n".

## Шаг 10. Вернуть управление.

Завершить выполнение функции.

## Шаг 11. Конец алгоритма.

## Шаг 12. Обработка исключений.

**Если возникло исключение в процессе выполнения:**

**Шаг 12.1. Перехватить исключение.**

В блоке `catch (const std::exception& e)` перехватить исключение.

**Шаг 12.2. Вывести сообщение об ошибке.**

Вывести сообщение: "Ошибка: " + `e.what()` + "\n".

**Шаг 12.3. Завершить выполнение функции.**

Вернуть управление вызывающему коду.

