# Алгоритм по шагам для функции adminAddRoute (New Route)

## Шаг 1. Начало.

**Входные данные:**
- `TransportSystem& system` – ссылка на систему транспорта, в которую будет добавлен маршрут;

**Выходные данные:**
- Сообщение об успешном создании маршрута или сообщение об ошибке;

## Шаг 2. Объявить переменные для хранения данных маршрута.

Инициализировать переменные:
- `int number` – номер маршрута;
- `std::string vehicleType` – тип транспорта (Автобус/Трамвай/Троллейбус);
- `std::vector<std::string> stops` – список остановок маршрута;
- `std::string stop` – временная переменная для ввода остановки;
- `std::shared_ptr<Route> route` – умный указатель на создаваемый маршрут;

## Шаг 3. Ввести номер маршрута.

Вывести приглашение: "Введите номер маршрута: ".

Выполнить ввод: `std::cin >> number`.

**Проверить корректность ввода:**
- Если ввод некорректен (`!(std::cin >> number)`):
  - Очистить поток ввода: `std::cin.clear()`
  - Игнорировать оставшиеся символы: `std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n')`
  - Сгенерировать исключение `InputException` с сообщением "Неверный формат ввода для номера маршрута"
  - Перейти к обработке исключений (Шаг 12)

Если ввод корректен, выполнить: `std::cin.ignore()` для очистки буфера.

## Шаг 4. Ввести тип транспорта.

Вывести приглашение: "Введите тип транспорта (Автобус/Трамвай/Троллейбус): ".

Выполнить ввод: `std::getline(std::cin, vehicleType)`.

## Шаг 5. Начать цикл ввода остановок.

Вывести приглашение: "Введите остановки маршрута (введите 'конец' для завершения):".

**Начало цикла:** `while (true)`

## Шаг 6. Ввести остановку.

Вывести приглашение: "Остановка: ".

Выполнить ввод: `std::getline(std::cin, stop)`.

## Шаг 7. Проверить условие завершения ввода.

Проверить условие: `stop == "конец"`.

**Если условие истинно (введено "конец"):**
- Выйти из цикла ввода остановок (перейти к Шагу 8)

**Если условие ложно (введена остановка):**
- Добавить остановку в список: `stops.push_back(stop)`
- Вернуться к Шагу 6 (продолжить ввод остановок)

## Шаг 8. Проверить наличие остановок в маршруте.

**Проверка выполняется в конструкторе Route:**

При создании объекта маршрута (Шаг 9) конструктор `Route::Route()` проверяет условие: `stops.empty()`.

**Если условие истинно (список остановок пуст):**
- Конструктор генерирует исключение `ContainerException` с сообщением "Маршрут не может быть пустым"
- Перейти к обработке исключений (Шаг 12)

**Если условие ложно (есть остановки):**
- Продолжить выполнение (перейти к Шагу 9)

## Шаг 9. Создать объект маршрута.

Выполнить: `route = std::make_shared<Route>(number, vehicleType, stops)`.

**В конструкторе Route выполняется:**

**Шаг 9.1. Инициализация полей маршрута:**
- `this->number = num`
- `this->vehicleType = vType`
- `this->allStops = stops`
- `this->weekDays = days` (по умолчанию {1,2,3,4,5,6,7})

**Шаг 9.2. Проверка наличия остановок:**
- Проверить условие: `stops.empty()`
  - Если истинно: сгенерировать исключение `ContainerException` с сообщением "Маршрут не может быть пустым"
  - Если ложно: продолжить

**Шаг 9.3. Установить начальную и конечную остановки:**
- `this->startStop = stops.front()` – первая остановка из списка
- `this->endStop = stops.back()` – последняя остановка из списка

**Примечание:** Конструктор Route автоматически проверяет, что начальная и конечная остановки разные (если список содержит минимум 2 остановки).

## Шаг 10. Вызвать метод добавления маршрута в систему.

Выполнить: `system.addRoute(route)`.

**В методе `TransportSystem::addRoute()` выполняется:**

**Шаг 10.1. Проверить уникальность номера маршрута:**

**Начало цикла:** Для каждого маршрута `existingRoute` в списке `routes`:
- Получить номер существующего маршрута: `existingRoute->getNumber()`
- Проверить условие: `existingRoute->getNumber() == route->getNumber()`

**Если условие истинно (номер уже существует):**
- Сгенерировать исключение `ContainerException` с сообщением "Маршрут с номером " + std::to_string(route->getNumber()) + " уже существует"
- Перейти к обработке исключений (Шаг 12)

**Если условие ложно (номер уникален):**
- Продолжить проверку следующего маршрута

**Конец цикла проверки уникальности**

**Шаг 10.2. Создать команду для добавления маршрута:**

Выполнить: `commandHistory.executeCommand(std::make_unique<AddRouteCommand>(this, route))`.

**В методе `CommandHistory::executeCommand()` выполняется:**

**Шаг 10.2.1. Добавить команду в историю:**
- Добавить команду в стек истории команд
- Сохранить описание команды

**Шаг 10.2.2. Выполнить команду:**

Вызвать метод: `cmd->execute()`.

**В методе `AddRouteCommand::execute()` выполняется:**

**Шаг 10.2.2.1. Вызвать прямой метод добавления маршрута:**

Вызвать метод: `system->addRouteDirect(route)`.

**В методе `TransportSystem::addRouteDirect()` выполняется:**

**Шаг 10.2.2.1.1. Добавить маршрут в список:**

Выполнить: `routes.push_back(std::move(route))` – добавить маршрут в конец списка маршрутов системы.

## Шаг 11. Вывести сообщение об успешном создании.

Вывести сообщение: "Маршрут успешно добавлен!\n".

## Шаг 12. Обработка исключений.

**Если в процессе выполнения возникло исключение:**

Перехватить исключение в блоке `catch (const std::exception& e)`.

Вывести сообщение об ошибке: "Ошибка: " + `e.what()` + "\n".

## Шаг 13. Конец алгоритма.

Завершить выполнение функции.







