# Описание алгоритма расчета времени прибытия (Calculating Time)

## Упрощенный алгоритм для блок-схемы

```
АЛГОРИТМ: Расчет времени прибытия для рейса

НАЧАЛО

1. Объявить переменные:
   - tripId (int)
   - averageSpeed (double)
   - tripIt (итератор)
   - trip (shared_ptr<Trip>)
   - route (ссылка на Route)
   - stopsList (ссылка на vector<string>)
   - currentTime (Time)
   - distanceBetweenStops (double)
   - travelTimeMinutes (double)
   - arrivalTime (Time)
   - stopTime (int)
   
   Код: `int tripId; double speed;` (ui.cpp:704-705)

2. Вывести список доступных рейсов
   Код: `const auto& trips = system.getTrips();` (ui.cpp:688)
   
   ЕСЛИ список рейсов пуст ТО
      Вывести: "В системе нет рейсов"
      Код: `if (trips.empty()) { std::cout << "В системе нет рейсов.\n"; return; }` (ui.cpp:689-692)
      КОНЕЦ
   КОНЕЦ ЕСЛИ
   
   Вывод списка рейсов:
   Код: 
   ```cpp
   std::cout << "\n=== ДОСТУПНЫЕ РЕЙСЫ ===\n";
   for (const auto& trip : trips) {
       std::cout << "ID: " << trip->getTripId() << ... << '\n';
   }
   ``` (ui.cpp:694-702)

3. Ввести tripId
   Код: `std::cout << "Введите ID рейса: ";` (ui.cpp:707)
   Код: `if (!(std::cin >> tripId)) { ... }` (ui.cpp:708)
   
   ЕСЛИ ввод некорректен ТО
      Вывести ошибку ввода
      Код: `throw InputException("Неверный формат ввода для ID рейса");` (ui.cpp:711)
      КОНЕЦ
   КОНЕЦ ЕСЛИ

4. Ввести averageSpeed
   Код: `std::cout << "Введите среднюю скорость (км/ч): ";` (ui.cpp:713)
   Код: `if (!(std::cin >> speed)) { ... }` (ui.cpp:714)
   
   ЕСЛИ ввод некорректен ТО
      Вывести ошибку ввода
      Код: `throw InputException("Неверный формат ввода для скорости");` (ui.cpp:717)
      КОНЕЦ
   КОНЕЦ ЕСЛИ
   
   Код: `std::cin.ignore();` (ui.cpp:719)

5. ЕСЛИ averageSpeed <= 0 ТО
      Вывести ошибку: "Средняя скорость должна быть положительной"
      Код: `if (averageSpeed <= 0) { throw InputException("Средняя скорость должна быть положительной"); }` (algorithm.cpp:114-115)
      КОНЕЦ
   КОНЕЦ ЕСЛИ

6. Вызвать system.calculateArrivalTimes(tripId, averageSpeed)
   Код: `system.calculateArrivalTimes(tripId, speed);` (ui.cpp:721)
   
   6.1. Найти рейс в коллекции trips:
        Код: `const auto& trips = system->getTrips();` (algorithm.cpp:118)
        Код: 
        ```cpp
        auto tripIt = std::find_if(trips.begin(), trips.end(),
                                   [tripId](const auto& t) { return t->getTripId() == tripId; });
        ``` (algorithm.cpp:119-120)
        
        ЕСЛИ tripIt == trips.end() ТО
           Вывести ошибку: "Рейс с ID [tripId] не найден"
           Код: `if (tripIt == trips.end()) { throw ContainerException("Рейс с ID " + std::to_string(tripId) + " не найден"); }` (algorithm.cpp:122-123)
           КОНЕЦ
        КОНЕЦ ЕСЛИ
   
   6.2. Получить информацию о рейсе:
        Код: `auto trip = *tripIt;` (algorithm.cpp:126)
        Код: `const auto& stopsList = trip->getRoute()->getAllStops();` (algorithm.cpp:127)
        Код: `Time currentTime = trip->getStartTime();` (algorithm.cpp:133)
   
   6.3. ЕСЛИ stopsList.empty() ТО
           Вывести ошибку: "Маршрут не содержит остановок"
           Код: `if (stopsList.empty()) { throw ContainerException("Маршрут не содержит остановок"); }` (algorithm.cpp:129-130)
           КОНЕЦ
        КОНЕЦ ЕСЛИ
   
   6.4. Установить время прибытия на начальную остановку:
        Код: `trip->setArrivalTime(stopsList[0], currentTime);` (algorithm.cpp:134)
   
   6.5. Цикл расчета времени для всех остановок:
        Код: `for (size_t i = 1; i < stopsList.size(); ++i) {` (algorithm.cpp:139)
           
           6.5.1. Рассчитать расстояние между остановками:
                  [Идеально]: `distanceBetweenStops = calculateDistance(stopsList[i-1], stopsList[i]);`
                  [Текущая реализация]: Используется константа
                  Код: `const double distanceBetweenStops = 1.5; // км` (algorithm.cpp:136)
           
           6.5.2. Рассчитать время в пути:
                  Код: `double travelTimeMinutes = (distanceBetweenStops / averageSpeed) * 60;` (algorithm.cpp:140)
                  Код: `Time arrivalTime = currentTime + static_cast<int>(travelTimeMinutes + 0.5);` (algorithm.cpp:141)
           
           6.5.3. Определить время прибытия:
                  Код: `trip->setArrivalTime(stopsList[i], arrivalTime);` (algorithm.cpp:142)
           
           6.5.4. Определить время стоянки:
                  [Идеально]: `stopTime = getStopTime(stopsList[i]);`
                  [Текущая реализация]: Используется константа
                  Код: `const int stopTime = 1; // минута` (algorithm.cpp:137)
           
           6.5.5. Определить время отправления:
                  Код: `currentTime = arrivalTime + stopTime;` (algorithm.cpp:143)
                  [Примечание: в текущей реализации не вызывается setDepartureTime, время отправления = время прибытия + стоянка]
        
        КОНЕЦ ДЛЯ
   
   6.6. Сохранить рассчитанное расписание:
        [Примечание: в текущей реализации расписание сохраняется автоматически при вызове setArrivalTime]
        [Идеально]: `trip->saveSchedule();`

7. Вывести обновленное расписание рейса
   Код: 
   ```cpp
   auto tripIt = std::find_if(trips.begin(), trips.end(),
                              [tripId](const auto& t) { return t->getTripId() == tripId; });
   if (tripIt != trips.end()) {
       auto trip = *tripIt;
       std::cout << "\nОбновленное расписание для рейса " << tripId << ":\n";
       const auto& schedule = trip->getSchedule();
       for (const auto& [stop, time] : schedule) {
           std::cout << "  " << stop << " - " << time << '\n';
       }
   }
   ``` (ui.cpp:723-732)

8. Вывести: "Расчет времени прибытия выполнен успешно"
   [Примечание: в текущей реализации явное сообщение об успехе не выводится, только расписание]

КОНЕЦ
```

## Блок-схема алгоритма

```
Начало
    ↓
Вывести список доступных рейсов
    ↓
┌─────────────────────────────┐
│ Список рейсов пуст?         │
└─────────────────────────────┘
    ↓
    ├─→ ДА
    │       ↓
    │   Вывести: "В системе нет рейсов"
    │       ↓
    │   Конец
    │
    └─→ НЕТ
            ↓
        Ввести tripId
            ↓
        ┌─────────────────────────────┐
        │ Ввод некорректен?           │
        └─────────────────────────────┘
            ↓
            ├─→ ДА → Ошибка ввода → Конец
            │
            └─→ НЕТ
                    ↓
                Ввести averageSpeed
                    ↓
                ┌─────────────────────────────┐
                │ Ввод некорректен?            │
                └─────────────────────────────┘
                    ↓
                    ├─→ ДА → Ошибка ввода → Конец
                    │
                    └─→ НЕТ
                            ↓
                        ┌─────────────────────────────┐
                        │ averageSpeed <= 0?          │
                        └─────────────────────────────┘
                            ↓
                            ├─→ ДА → Ошибка → Конец
                            │
                            └─→ НЕТ
                                    ↓
                                Найти рейс в коллекции
                                    ↓
                                ┌─────────────────────────────┐
                                │ Рейс найден?                │
                                └─────────────────────────────┘
                                    ↓
                                    ├─→ НЕТ
                                    │       ↓
                                    │   Вывести ошибку: "Рейс не найден"
                                    │       ↓
                                    │   Конец
                                    │
                                    └─→ ДА
                                            ↓
                                        Получить информацию о рейсе
                                            ↓
                                        ┌─────────────────────────────┐
                                        │ stopsList.empty()?          │
                                        └─────────────────────────────┘
                                            ↓
                                            ├─→ ДА → Ошибка → Конец
                                            │
                                            └─→ НЕТ
                                                    ↓
                                                Установить время на начальной остановке
                                                    ↓
                                                ┌─────────────────────────────┐
                                                │ Начало цикла:               │
                                                │ i = 1; i < stopsList.size() │
                                                └─────────────────────────────┘
                                                    ↓
                                                    ├─→ НЕТ (цикл завершен)
                                                    │       ↓
                                                    │   Сохранить расписание
                                                    │       ↓
                                                    │   Вывести обновленное расписание
                                                    │       ↓
                                                    │   Вывести: "Расчет выполнен успешно"
                                                    │       ↓
                                                    │   Конец
                                                    │
                                                    └─→ ДА (продолжить цикл)
                                                            ↓
                                                        Рассчитать расстояние
                                                            ↓
                                                        Рассчитать время в пути
                                                            ↓
                                                        Определить время прибытия
                                                            ↓
                                                        Определить время стоянки
                                                            ↓
                                                        Определить время отправления
                                                            ↓
                                                        currentTime = arrivalTime + stopTime
                                                            ↓
                                                        i = i + 1
                                                            ↓
                                                        [Вернуться к проверке цикла]
```

## Подробный алгоритм расчета времени прибытия

### Начало

### Шаг 1: Объявить переменные

- `int tripId` - идентификатор рейса
- `double averageSpeed` - средняя скорость транспорта (км/ч)
- `std::vector<std::shared_ptr<Trip>>::const_iterator tripIt` - итератор для поиска рейса
- `std::shared_ptr<Trip> trip` - умный указатель на рейс
- `const std::shared_ptr<Route>& route` - ссылка на маршрут рейса
- `const std::vector<std::string>& stopsList` - ссылка на список остановок
- `Time currentTime` - текущее время
- `double distanceBetweenStops` - расстояние между остановками (км)
- `double travelTimeMinutes` - время в пути в минутах
- `Time arrivalTime` - время прибытия на остановку
- `int stopTime` - время стоянки на остановке (минуты)

### Шаг 2: Вывести список доступных рейсов

- Получить список рейсов: `trips = system.getTrips()`
  - **Код:** `const auto& trips = system.getTrips();` (ui.cpp:688)
- **Проверка условия:** `trips.empty()`
  - **Если ДА:** Вывести "В системе нет рейсов" и завершить алгоритм
    - **Код:** 
      ```cpp
      if (trips.empty()) {
          std::cout << "В системе нет рейсов.\n";
          return;
      }
      ``` (ui.cpp:689-692)
  - **Если НЕТ:** Продолжить выполнение
- Вывести заголовок: "=== ДОСТУПНЫЕ РЕЙСЫ ==="
  - **Код:** `std::cout << "\n=== ДОСТУПНЫЕ РЕЙСЫ ===\n";` (ui.cpp:694)
- **Начало цикла:** Для каждого рейса `trip` в `trips`:
  - Вывести информацию о рейсе: ID, номер маршрута, время отправления, направление
    - **Код:**
      ```cpp
      for (const auto& trip : trips) {
          std::cout << "ID: " << trip->getTripId()
                    << " | Маршрут: " << trip->getRoute()->getNumber()
                    << " | Отправление: " << trip->getStartTime()
                    << " | Направление: " << trip->getRoute()->getStartStop()
                    << " → " << trip->getRoute()->getEndStop() << '\n';
      }
      ``` (ui.cpp:695-701)
- **Конец цикла**
- Вывести разделитель: "========================"
  - **Код:** `std::cout << "========================\n\n";` (ui.cpp:702)

### Шаг 3: Ввести идентификатор рейса

- Вывести приглашение: "Введите ID рейса: "
  - **Код:** `std::cout << "Введите ID рейса: ";` (ui.cpp:707)
- Считать `tripId` из стандартного ввода
  - **Код:** `if (!(std::cin >> tripId)) {` (ui.cpp:708)
- **Проверка условия:** Ввод некорректен
  - **Если ДА:**
    - Очистить буфер ввода
      - **Код:** 
        ```cpp
        std::cin.clear();
        std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
        ``` (ui.cpp:709-710)
    - Сгенерировать исключение `InputException` с сообщением "Неверный формат ввода для ID рейса"
      - **Код:** `throw InputException("Неверный формат ввода для ID рейса");` (ui.cpp:711)
    - Перейти к обработке исключений (Шаг 9)
  - **Если НЕТ:** Продолжить выполнение

### Шаг 4: Ввести среднюю скорость

- Вывести приглашение: "Введите среднюю скорость (км/ч): "
  - **Код:** `std::cout << "Введите среднюю скорость (км/ч): ";` (ui.cpp:713)
- Считать `averageSpeed` из стандартного ввода
  - **Код:** `if (!(std::cin >> speed)) {` (ui.cpp:714)
- **Проверка условия:** Ввод некорректен
  - **Если ДА:**
    - Очистить буфер ввода
      - **Код:**
        ```cpp
        std::cin.clear();
        std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
        ``` (ui.cpp:715-716)
    - Сгенерировать исключение `InputException` с сообщением "Неверный формат ввода для скорости"
      - **Код:** `throw InputException("Неверный формат ввода для скорости");` (ui.cpp:717)
    - Перейти к обработке исключений (Шаг 9)
  - **Если НЕТ:** Продолжить выполнение
- Очистить буфер ввода
  - **Код:** `std::cin.ignore();` (ui.cpp:719)

### Шаг 5: Проверить корректность скорости

- **Проверка условия:** `averageSpeed <= 0`
  - **Код:** `if (averageSpeed <= 0) {` (algorithm.cpp:114)
  - **Если ДА:**
    - Сгенерировать исключение `InputException` с сообщением "Средняя скорость должна быть положительной"
      - **Код:** `throw InputException("Средняя скорость должна быть положительной");` (algorithm.cpp:115)
    - Перейти к обработке исключений (Шаг 9)
  - **Если НЕТ:** Продолжить выполнение

### Шаг 6: Вызвать метод расчета времени прибытия

- Вызвать: `system.calculateArrivalTimes(tripId, averageSpeed)`
  - **Код:** `system.calculateArrivalTimes(tripId, speed);` (ui.cpp:721)

**В методе `TransportSystem::calculateArrivalTimes()`:**
- Вызвать: `arrivalTimeAlgorithm->calculateArrivalTimes(tripId, averageSpeed)`
  - **Код:** `arrivalTimeAlgorithm->calculateArrivalTimes(tripId, averageSpeed);` (transport_system.cpp:117)

**В методе `ArrivalTimeCalculationAlgorithm::calculateArrivalTimes()`:**

**6.1. Найти рейс в коллекции:**
- Получить список рейсов: `trips = system->getTrips()`
  - **Код:** `const auto& trips = system->getTrips();` (algorithm.cpp:118)
- Найти рейс: `tripIt = std::find_if(trips.begin(), trips.end(), [tripId](const auto& t) { return t->getTripId() == tripId; })`
  - **Код:**
    ```cpp
    auto tripIt = std::find_if(trips.begin(), trips.end(),
                               [tripId](const auto& t) { return t->getTripId() == tripId; });
    ``` (algorithm.cpp:119-120)
- **Проверка условия:** `tripIt == trips.end()`
  - **Код:** `if (tripIt == trips.end()) {` (algorithm.cpp:122)
  - **Если ДА (рейс не найден):**
    - Сгенерировать исключение `ContainerException` с сообщением "Рейс с ID [tripId] не найден"
      - **Код:** `throw ContainerException("Рейс с ID " + std::to_string(tripId) + " не найден");` (algorithm.cpp:123)
    - Перейти к обработке исключений (Шаг 9)
  - **Если НЕТ:** Продолжить выполнение

**6.2. Получить информацию о рейсе:**
- Разыменовать итератор: `trip = *tripIt`
  - **Код:** `auto trip = *tripIt;` (algorithm.cpp:126)
- Получить маршрут: `route = trip->getRoute()`
  - [Используется неявно через цепочку вызовов]
- Получить список остановок: `stopsList = route->getAllStops()`
  - **Код:** `const auto& stopsList = trip->getRoute()->getAllStops();` (algorithm.cpp:127)
- Получить время отправления: `currentTime = trip->getStartTime()`
  - **Код:** `Time currentTime = trip->getStartTime();` (algorithm.cpp:133)

**6.3. Проверить, что список остановок не пустой:**
- **Проверка условия:** `stopsList.empty()`
  - **Код:** `if (stopsList.empty()) {` (algorithm.cpp:129)
  - **Если ДА:**
    - Сгенерировать исключение `ContainerException` с сообщением "Маршрут не содержит остановок"
      - **Код:** `throw ContainerException("Маршрут не содержит остановок");` (algorithm.cpp:130)
    - Перейти к обработке исключений (Шаг 9)
  - **Если НЕТ:** Продолжить выполнение

**6.4. Установить время прибытия на начальную остановку:**
- Установить время: `trip->setArrivalTime(stopsList[0], currentTime)`
  - **Код:** `trip->setArrivalTime(stopsList[0], currentTime);` (algorithm.cpp:134)

**6.5. Цикл расчета времени для всех остановок:**
- **Начало цикла:** `for (size_t i = 1; i < stopsList.size(); ++i)`
  - **Код:** `for (size_t i = 1; i < stopsList.size(); ++i) {` (algorithm.cpp:139)

  **6.5.1. Рассчитать расстояние между остановками:**
  - **В идеальной реализации:** `distanceBetweenStops = calculateDistance(stopsList[i-1], stopsList[i])`
  - **В текущей реализации:** Используется константа `distanceBetweenStops = 1.5` (км)
    - **Код:** `const double distanceBetweenStops = 1.5; // км` (algorithm.cpp:136)
  - **Примечание:** Функция `calculateDistance()` должна быть реализована для расчета реального расстояния между остановками

  **6.5.2. Рассчитать время в пути:**
  - Вычислить: `travelTimeMinutes = (distanceBetweenStops / averageSpeed) * 60`
    - **Код:** `double travelTimeMinutes = (distanceBetweenStops / averageSpeed) * 60;` (algorithm.cpp:140)
  - Округлить до целых минут: `travelTimeMinutes = static_cast<int>(travelTimeMinutes + 0.5)`
    - **Код:** `Time arrivalTime = currentTime + static_cast<int>(travelTimeMinutes + 0.5);` (algorithm.cpp:141)

  **6.5.3. Определить время прибытия на следующую остановку:**
  - Вычислить: `arrivalTime = currentTime + travelTimeMinutes`
    - [Вычисляется в предыдущем шаге]
  - Записать время прибытия: `trip->setArrivalTime(stopsList[i], arrivalTime)`
    - **Код:** `trip->setArrivalTime(stopsList[i], arrivalTime);` (algorithm.cpp:142)

  **6.5.4. Определить время стоянки на остановке:**
  - **В идеальной реализации:** `stopTime = getStopTime(stopsList[i])`
  - **В текущей реализации:** Используется константа `stopTime = 1` (минута)
    - **Код:** `const int stopTime = 1; // минута` (algorithm.cpp:137)
  - **Примечание:** Функция `getStopTime()` должна быть реализована для получения времени стоянки для конкретной остановки

  **6.5.5. Определить время отправления со следующей остановки:**
  - Вычислить: `currentTime = arrivalTime + stopTime`
    - **Код:** `currentTime = arrivalTime + stopTime;` (algorithm.cpp:143)
  - Записать время отправления: `trip->setDepartureTime(stopsList[i], currentTime)`
    - [Примечание: в текущей реализации setDepartureTime не вызывается явно, время отправления = время прибытия + стоянка]

- **Конец цикла**

**6.6. Сохранить рассчитанное расписание:**
- **В идеальной реализации:** Вызвать `trip->saveSchedule()` для сохранения расписания
- **В текущей реализации:** Расписание сохраняется автоматически при установке времени через `setArrivalTime()` и `setDepartureTime()`

### Шаг 7: Вывести обновленное расписание

- Найти рейс в коллекции (для вывода)
  - **Код:**
    ```cpp
    auto tripIt = std::find_if(trips.begin(), trips.end(),
                              [tripId](const auto& t) { return t->getTripId() == tripId; });
    ``` (ui.cpp:723-724)
- Вывести заголовок: "Обновленное расписание для рейса [tripId]:"
  - **Код:** `std::cout << "\nОбновленное расписание для рейса " << tripId << ":\n";` (ui.cpp:727)
- Получить расписание: `schedule = trip->getSchedule()`
  - **Код:** `const auto& schedule = trip->getSchedule();` (ui.cpp:728)
- **Начало цикла:** Для каждой пары `[stop, time]` в `schedule`:
  - **Код:** `for (const auto& [stop, time] : schedule) {` (ui.cpp:729)
  - Вывести: "[stop] - [time]"
    - **Код:** `std::cout << "  " << stop << " - " << time << '\n';` (ui.cpp:730)
- **Конец цикла**

### Шаг 8: Вывести сообщение об успешном расчете

- Вывести: "Расчет времени прибытия выполнен успешно"
- Перейти к Шагу 10 (Конец)

### Шаг 9: Обработка исключений

- Перехватить исключение типа `std::exception`
  - **Код:** `catch (const std::exception& e) {` (ui.cpp:733)
- Вывести: "Ошибка: [сообщение исключения]"
  - **Код:** `std::cout << "Ошибка: " << e.what() << "\n";` (ui.cpp:734)
- Перейти к Шагу 10 (Конец)

### Шаг 10: Конец

## Исключения (Exceptions) в алгоритме

В процессе выполнения алгоритма могут быть выброшены следующие исключения:

### 1. InputException
**Где возникает:** Шаг 3 (Ввод tripId)
- **Сообщение:** "Неверный формат ввода для ID рейса"
- **Условие:** Некорректный ввод идентификатора рейса (не число)
- **Код:** `throw InputException("Неверный формат ввода для ID рейса");`

### 2. InputException
**Где возникает:** Шаг 4 (Ввод averageSpeed)
- **Сообщение:** "Неверный формат ввода для скорости"
- **Условие:** Некорректный ввод скорости (не число)
- **Код:** `throw InputException("Неверный формат ввода для скорости");`

### 3. InputException
**Где возникает:** Шаг 5 (Проверка скорости)
- **Сообщение:** "Средняя скорость должна быть положительной"
- **Условие:** `averageSpeed <= 0`
- **Код:** `throw InputException("Средняя скорость должна быть положительной");`
- **Место:** В методе `ArrivalTimeCalculationAlgorithm::calculateArrivalTimes()`

### 4. ContainerException
**Где возникает:** Шаг 6.1 (Поиск рейса)
- **Сообщение:** "Рейс с ID [tripId] не найден"
- **Условие:** `tripIt == trips.end()`
- **Код:** `throw ContainerException("Рейс с ID " + std::to_string(tripId) + " не найден");`
- **Место:** В методе `ArrivalTimeCalculationAlgorithm::calculateArrivalTimes()`

### 5. ContainerException
**Где возникает:** Шаг 6.3 (Проверка списка остановок)
- **Сообщение:** "Маршрут не содержит остановок"
- **Условие:** `stopsList.empty() == true`
- **Код:** `throw ContainerException("Маршрут не содержит остановок");`
- **Место:** В методе `ArrivalTimeCalculationAlgorithm::calculateArrivalTimes()`

## Иерархия исключений

```
std::exception
    └── TransportException (базовый класс)
        ├── InputException (ошибки ввода)
        ├── ContainerException (ошибки работы с контейнерами)
        └── FileException (ошибки работы с файлами)
```

## Обработка исключений

Все исключения перехватываются в блоке `try-catch` функции `calculateArrivalTime()`:

```cpp
try {
    // ... выполнение алгоритма ...
} catch (const std::exception& e) {
    std::cout << "Ошибка: " << e.what() << "\n";
}
```

Это означает, что любое исключение (InputException, ContainerException и их базовый класс TransportException) будет перехвачено и выведено сообщение об ошибке.

## Особенности реализации

1. **Паттерн Strategy:** Использование паттерна Strategy через класс `ArrivalTimeCalculationAlgorithm` позволяет:
   - Легко изменять алгоритм расчета времени
   - Изолировать логику расчета от основной системы
   - Тестировать алгоритм независимо

2. **Расстояние между остановками:** 
   - **Текущая реализация:** Используется константа `1.5 км` для всех остановок
   - **Рекомендуется:** Реализовать функцию `calculateDistance(stop1, stop2)` для расчета реального расстояния

3. **Время стоянки:**
   - **Текущая реализация:** Используется константа `1 минута` для всех остановок
   - **Рекомендуется:** Реализовать функцию `getStopTime(stop)` для получения времени стоянки для конкретной остановки

4. **Сохранение расписания:**
   - **Текущая реализация:** Расписание сохраняется автоматически при установке времени
   - **Рекомендуется:** Добавить явный вызов `trip->saveSchedule()` для сохранения расписания

## Структура вызовов

```
calculateArrivalTime()
    ↓
TransportSystem::calculateArrivalTimes()
    ↓
ArrivalTimeCalculationAlgorithm::calculateArrivalTimes()
    ↓
trip->setArrivalTime() / trip->setDepartureTime()
    ↓
[Сохранение расписания в объекте Trip]
```

